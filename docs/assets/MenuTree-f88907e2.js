import{_ as b,h as y,j as R,r as $,o as l,k as i,w as u,e as f,b as c,l as P,m as p,n as h,t as S,g as D,d as C,p as j,q as o,s as A,E as B,i as U}from"./index-a9f31147.js";const q={class:"reactive-menu-tree-node"},F={class:"reactive-menu-tree-node-name"},I={class:"reactive-menu-tree-node-tool"},K={__name:"ReactiveMenuTree",props:{menuData:Array,isOpenDrag:{type:Boolean,default:!0},isOpenRename:{type:Boolean,default:!0},isOpenDefault:{type:Boolean,default:!0},isOpenCheck:{type:Boolean,default:!0}},setup(m){const r=m;let d=y([]);R(r.menuData,()=>{d=y(k(r.menuData))},{immediate:!0});const s=$(null);function x(a){o.forEach(a.parent.childNodes,e=>{e.data.config.isDefault=!1}),a.data.config.isDefault=!0}function E(a){A.prompt("","重命名",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputPattern:/.+/,inputValue:a.data.name,inputErrorMessage:"请输入名称"}).then(({value:e})=>{a.data.name=e,B({type:"success",message:"重命名成功"})}).catch(()=>{B({type:"info",message:"已取消重命名"})})}function M(a){g(a),_(a)}function g(a){const e=a.childNodes;for(const t of e||[])t.data.checked=a.data.checked,g(t)}function _(a){const e=a.parent;console.log(a);const t=s.value.getNode(a.data);if(console.log(a,t),e){const n=!!o.find(e.childNodes,"data.checked");n!==e.data.checked&&(e.data.checked=n,_(e))}}function N(){return!0}function O(a,e,t){return a.data.pid===e.data.pid?t!=="inner":!1}function T(a){var n,v;let t=((v=(n=s.value.getNode(a.data).parent)==null?void 0:n.data)==null?void 0:v.children)||s.value.data;o.forEach(t,(w,V)=>{w.order=V})}function k(a){for(const e of o.cloneDeep(a))e.id=e.id.toString?e.id.toString():e.id,e&&e.children&&e.children.length&&(e.children=k(e.children));return o.filter(o.orderBy(a,["order"],["asc"]),e=>e.enable!==!1)}return(a,e)=>(l(),i(c(j),{class:"reactive-menu-tree",ref_key:"reactiveMenuTree",ref:s,"node-key":"id","highlight-current":"",onNodeDragEnd:T,"allow-drop":O,"allow-drag":N,draggable:r.isOpenDrag,data:c(d)},{default:u(({node:t})=>[f("div",q,[r.isOpenCheck?(l(),i(c(P),{key:0,onClick:e[0]||(e[0]=p(()=>{},["stop"])),onChange:n=>M(t),modelValue:t.data.checked,"onUpdate:modelValue":n=>t.data.checked=n},null,8,["onChange","modelValue","onUpdate:modelValue"])):h("",!0),f("div",F,S(t.data.name),1),f("div",I,[r.isOpenRename?(l(),i(c(D),{key:0,onClick:p(n=>E(t),["stop"]),type:"primary",link:""},{default:u(()=>[C(" 重命名 ")]),_:2},1032,["onClick"])):h("",!0),!t.data.config.notBeDefault&&r.isOpenDefault?(l(),i(c(D),{key:1,onClick:p(n=>x(t),["stop"]),type:t.data.config.isDefault?"danger":"primary",link:""},{default:u(()=>[C(" 设为默认 ")]),_:2},1032,["onClick","type"])):h("",!0)])])]),_:1},8,["draggable","data"]))}},z=b(K,[["__scopeId","data-v-001f7007"]]),H={__name:"MenuTree",setup(m){const r=U("reactiveMenuData");return(d,s)=>(l(),i(z,{"menu-data":c(r).menus},null,8,["menu-data"]))}};export{H as default};
