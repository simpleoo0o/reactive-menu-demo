import{aA as N,v as M,by as m,B as p,aU as c,bz as _,bA as O,l as k,au as j,as as E,u as F}from"./index-e5a2ad71.js";const i=N({menus:[],secondMenus:[],mock:{},currentMenu:null,currentMenuWithParents:[],activeIndex:null,topActiveIndex:null,config:{autoIndex:!0,selfJump:!1,disableMock:!1,resetId:!1},methods:{jump:W,updateMenus:b,goDefault:V,matchRoute:v,resetId:A}});let y=null,I=null;function L(n,e){return i.mock=d(e.mock||{}),(M(e.mock)||m(e.mock))&&p(e.mock,()=>{i.mock=d(e.mock||{})}),i.config=c.merge({},i.config,d(e.config||{})),(M(e.config)||m(e.config))&&p(e.config,()=>{i.config=c.merge({},i.config,d(e.config||{}))}),y=_(),I=O(),b(n),(M(n)||m(n))&&p(n,()=>{b(n)}),i.secondMenus=k({get(){const t=c.findLast(i.currentMenuWithParents,r=>r.config&&r.config.boundary&&i.currentMenu&&r.id!==i.currentMenu.id&&r.type==="menu");return t?c.filter(t.children||[],["type","menu"]):[]}}),i.activeIndex=k(()=>{var t;return(t=i.currentMenu)==null?void 0:t.id}),i.topActiveIndex=k(()=>{var t,r;return((t=c.find(i.currentMenuWithParents||[],u=>u.config.boundary&&u.type==="menu"))==null?void 0:t.id)||((r=c.findLast(i.currentMenuWithParents||[],u=>u.type==="menu"))==null?void 0:r.id)}),p(I,()=>{v()}),j("reactiveMenuData",i),i}function b(n){i.currentMenu=null,i.currentMenuWithParents=[],n=c.cloneDeep(d(n)),i.config.resetId&&A(n),i.menus=D(n),v()}function D(n){for(const e of n)e.id=e.id.toString?e.id.toString():e.id,e.type=e.type??"menu",e.config=e.config??{},e&&e.children&&e.children.length&&(e.children=D(e.children));return c.filter(c.orderBy(n,["order"],["asc"]),e=>e.enable!==!1&&e.checked!==!1)}function v(n=I,e=!0,t=!0){const r=(o,a)=>{var l;for(const s of o){const f=[...a];if(f.push(s),B(s,n)){const h=c.findLast(f,["type","menu"])||s;return{currentMenuWithParents:f,currentMenu:h}}else if(s&&s.children&&s.children.length){const h=r(s.children,f);if((l=h==null?void 0:h.currentMenuWithParents)!=null&&l.length)return h}}return{currentMenuWithParents:[],currentMenu:null}},u=r(i.menus,[]);return e&&(i.currentMenuWithParents=u.currentMenuWithParents,i.currentMenu=u.currentMenu),t&&C(),u}function B(n,e){if(!n.config||!n.config.route)return!1;let t=n.config.route;if(t.path&&!t.name){const r=y.resolve(g(t.path,!0).replace(/\?}/g,"%3F}"));if(r.name){t={...d(t)},t.name=r.name,t.params=[],t.query=[...t.query||[]];for(const u of["params","query"])for(const o in r[u])t[u].push({key:o,value:r[u][o],isReal:r[u][o]?!r[u][o].endsWith("?}"):!1})}}if((e==null?void 0:e.name)===t.name&&t.name){for(const r of["params","query"]){const u=P(t[r],!0)||{};for(const o in u||{})if(!q(u[o],e[r][o]))return!1}if(t.hash&&!q(g(t.hash,!0),e.hash))return!1}else return!1;return!0}function q(n,e){return new RegExp("^"+c.escapeRegExp(n).replace(/(\/?\\\$\\{.*?\\\?\\})+/g,".*?")+"$").test(e)}function P(n,e){const t={};if(n){for(const r of n)if(!e||e&&r.isReal)if(Object.prototype.hasOwnProperty.call(r,"value")){let u=r.value;typeof u=="string"&&(u=g(u,e)),t[r.key]=u}else t[r.key]=w(r.key)}return t}function g(n,e){return R("disableMock")?n:n.replace(/\$\{(.*?)(\?)?}/g,(t,r,u)=>u&&e?t:w(r))}function V(n=i.menus){const e=x(n);W(e)}function x(n){let e=c.find(n,t=>t.config&&t.config.isDefault&&!t.config.disabled);return e||(e=c.find(n,t=>t.type==="menu"&&!t.config.disabled)),e&&e.children&&e.children.length&&(!e.config.route||e.config.route&&!e.config.route.name)?x(e.children):e}function W(n){if(n){if(n&&n.config&&n.config.route){const e=c.cloneDeep(n.config.route);return e&&(e.params=P(e.params)),e.query&&(e.query=P(e.query)),e.hash&&(e.hash=g(e.hash)),e.path&&(e.path=g(e.path),e.query&&(e.path+=(e.path.includes("?")?"&":"?")+c.map(c.keys(e.query),t=>`${t}=${encodeURIComponent(e.query[t])}`).join("&")),e.hash&&(e.path+=e.hash)),!n.config.target||n.config.target==="_self"?y.push(e.path||e):window.open(e.path||y.resolve(e).href,n.config.target),n}else if(n.children&&n.children.length&&n.config.boundary)return W(x(n.children))}}function w(n){if(R("disableMock"))return n;if(n==="__date__")return new Date().getTime();const e=d(i.mock);return c.get(e,n)}function R(n){const e=d(i.config);return c.get(e,n)}function d(n){return m(n)?E(n):F(n)}function C(){const n=R("autoIndex");!i.currentMenuWithParents.length&&n&&(n instanceof Function?n(i):V())}function A(n){var o;const e=[],t=[],r=(a,l)=>{var s;for(const f of a)f.id||f.id===0?e.push(f.id):t.push(f),(l||l===0)&&(f.parentId=l),(s=f.children)!=null&&s.length&&r(f.children,f.id)};r(n);let u=Math.max(...e.map(a=>isNaN(Number(a))?0:Number(a)),0);for(const a of t)if(a.id=++u,(o=a.children)!=null&&o.length)for(const l of a.children)l.parentId=a.id}export{L as u};
